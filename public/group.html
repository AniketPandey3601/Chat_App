<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Management</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Group Management</h1>

    <div id="groupInfo">
        <h2>Group Name: <span id="groupName"></span></h2>
        <h3>Group Members:</h3>
        <ul id="groupMembers"></ul>
        <input type="text" id="newMemberInput" placeholder="Enter user ID">
        <button id="addMemberButton">Add Member</button>
        <button id="leaveGroupButton">Leave Group</button>
    </div>

    <div id="messageContainer">
        <input type="text" id="messageInput" placeholder="Type your message..." required>
        <button id="sendButton">Send</button>
    </div>

    <script>
        const baseURL = ''; // Replace with your backend URL
        const groupId = window.location.search.split('=')[1]; // Get group ID from URL parameter

        async function displayGroupInfo() {
            try {
                const response = await axios.get(baseURL + `/groups/${groupId}`);
                const { name, members } = response.data.group;

                document.getElementById('groupName').textContent = name;

                const groupMembersList = document.getElementById('groupMembers');
                groupMembersList.innerHTML = '';

                members.forEach(member => {
                    const listItem = document.createElement('li');
                    listItem.textContent = member.name;
                    groupMembersList.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error fetching group info:', error);
            }
        }

        async function addMember() {
            try {
                const userId = document.getElementById('newMemberInput').value.trim();
                if (!userId) {
                    alert('Please enter user ID');
                    return;
                }

                await axios.put(baseURL + `/groups/${groupId}/members`, {
                    userIds: [userId],
                    action: 'add'
                });

                // Refresh group info after adding member
                displayGroupInfo();
                document.getElementById('newMemberInput').value = ''; // Clear input field
            } catch (error) {
                console.error('Error adding member:', error);
            }
        }

        async function leaveGroup() {
            try {
                await axios.delete(baseURL + `/groups/${groupId}/leave`);

                // Redirect to home page or another route after leaving group
                window.location.href = 'home.html';
            } catch (error) {
                console.error('Error leaving group:', error);
            }
        }

        async function sendMessage() {
            try {
                const message = document.getElementById('messageInput').value.trim();
                if (!message) {
                    alert('Please enter a message');
                    return;
                }

                await axios.post(baseURL + `/groups/${groupId}/messages`, {
                    message: message
                });

                // Clear input field after sending message
                document.getElementById('messageInput').value = '';
            } catch (error) {
                console.error('Error sending message:', error);
            }
        }

        document.getElementById('addMemberButton').addEventListener('click', addMember);
        document.getElementById('leaveGroupButton').addEventListener('click', leaveGroup);
        document.getElementById('sendButton').addEventListener('click', sendMessage);

        // Call displayGroupInfo on DOMContentLoaded
        window.addEventListener('DOMContentLoaded', displayGroupInfo);
    </script>
</body>
</html>
